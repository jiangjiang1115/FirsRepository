<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sarch</title>
    <!-- <link type="text/css" rel="stylesheet" href="./public/searchStyle.css" /> -->
</head>
<style>
    .container {
        margin-top: 15px;
        padding: 0 10px;
        box-sizing: border-box;
        margin-bottom: 10px;
        width: 100%;
        /* height: 100%; */
        display: grid;
        grid-template-columns: 8fr 6fr 8fr 1fr;
        font-size: 15px;
        padding-bottom: 15px;
        border-bottom: 1px rgba(128, 128, 128, 0.11) solid;
    }

    #resultSong {
        width: 100%;
    }

    .songContainer {
        padding: 2px 10px;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: 8fr 6fr 8fr 1fr;
        font-size: 12px;
        padding-top: 13px;
    }

    .songContainer:hover {
        background-color: rgba(127, 255, 212, 0.418);

    }

    .songContainer span img {
        width: 23px;
        height: 23px;
        position: relative;
        left: 5px;
        bottom: 6px;
        cursor: pointer;
    }
</style>

<body>
    <div class="container">
        <span>歌曲</span>
        <span>演唱者</span>
        <span>专辑名</span>
        <span>收藏</span>
    </div>
    <div id="resultSong">
        <!-- <div class="songContainer"> -->
        <!-- <span>花海</span>
            <span>周杰伦</span>
            <span>魔杰座</span>
            <span><img src="./public/image/collection.png" alt=""></span> -->
        <!-- </div> -->
    </div>
</body>
<script src="./history.js"></script>
<script>
    function loadHistory() {
        var resultSong = document.getElementById("resultSong")
        var loadHistory = window.parent.document.getElementById("loadHistory")
        var loadCollection = window.parent.document.getElementById("loadCollection")

        // 去重
        historyData = loadHistory.innerHTML.split("</div>");
        collectionData = loadCollection.innerHTML.split("</div>");
        console.log(collectionData)
        console.log(historyData)
        for (i = 0; i < historyData.length - 1; i++) {
            songID = historyData[i].split('"')[7];
            for (j = 0; j < historyData.length - 1; j++) {
                if (j > i && historyData[j] && songID == historyData[j].split('"')[7]) {
                    console.log("此处捕捉到重复")
                    historyData[j] = ""
                    // console.log(historyData[i + 1])
                }
            }
        }
        // 判断收藏,把每个试听的歌比对收藏歌曲的id
        for (i = 0; i <= historyData.length; i++) {
            if (collectionData[0]) {
                // 收藏不为空时
                for (j = 0; j <= collectionData.length; j++) {
                    // 在非空元素且id相等的情况下
                    if (historyData[i] && collectionData[j] && historyData[i].split('"')[7] == collectionData[j].split('"')[7]) {
                        console.log("这首歌被收藏啦",i)
                        currentSong = historyData[i].split('"')
                        currentSong[9] = "./public/image/star.png"
                        historyData[i] = currentSong.join("")
                        break;
                    }else if(j==collectionData.length-1&&historyData[i]&&historyData[i].split('"')[9]=="./public/image/star.png") {
                        // 非空元素且没有相同id时
                        currentSong = historyData[i].split('"')
                        currentSong[9] = "./public/image/collection.png"
                        historyData[i] = currentSong.join("")
                    }
                    
                }

            }else {
                // 收藏为空时判断为未收藏
                        if (historyData[i]) {
                            console.log("这首歌没有被收藏",i)
                            currentSong = historyData[i].split('"')
                            console.log(currentSong)
                            currentSong[9] = "./public/image/collection.png"
                            historyData[i] = currentSong.join("")
                        }

                    }


        }
        loadHistory.innerHTML = ''
        for (i = 0; i < historyData.length; i++) {
            if (historyData[i]) {
                historyData[i] += "</div>"
                loadHistory.innerHTML += historyData[i]
            }
        }
        resultSong.innerHTML = loadHistory.innerHTML


    }
    window.onload = loadHistory()
</script>

</html>